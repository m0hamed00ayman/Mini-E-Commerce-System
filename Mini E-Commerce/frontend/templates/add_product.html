<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Add Product - Mini E-Commerce</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='styles.css') }}">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>
<body>
    <nav class="navbar">
        <div class="nav-container">
            <div class="nav-brand">
                <i class="fas fa-shopping-cart"></i>
                <span>Mini E-Commerce</span>
            </div>
            <div class="nav-links">
                <a href="/" class="nav-link"><i class="fas fa-home"></i> Home</a>
                <a href="/products" class="nav-link"><i class="fas fa-store"></i> Products</a>
                <a href="/cart" class="nav-link"><i class="fas fa-shopping-cart"></i> Cart 
                    {% if session.cart %}<span class="cart-count">{{ session.cart|length }}</span>{% endif %}
                </a>
                <a href="/add-product" class="nav-link active"><i class="fas fa-plus-circle"></i> Add Product</a>
                <a href="/analytics/sales" class="nav-link"><i class="fas fa-chart-line"></i> Analytics</a>
            </div>
        </div>
    </nav>

    <main class="container">
        <div class="page-header">
            <h1><i class="fas fa-plus-circle"></i> Add New Product</h1>
            <p>Add products to our catalog. User submissions go to MongoDB, vendor products to SQL Server.</p>
        </div>

        <div class="form-container">
            <form method="POST" action="/add-product" class="product-form" id="productForm">
                <div class="form-grid">
                    <div class="form-section">
                        <h3><i class="fas fa-info-circle"></i> Basic Information</h3>
                        
                        <div class="form-group">
                            <label for="name">
                                <i class="fas fa-tag"></i> Product Name *
                            </label>
                            <input type="text" id="name" name="name" required 
                                   placeholder="Enter product name" 
                                   oninput="updatePreview('name', this.value)">
                            <div class="form-hint">Maximum 200 characters</div>
                        </div>
                        
                        <div class="form-group">
                            <label for="description">
                                <i class="fas fa-align-left"></i> Description
                            </label>
                            <textarea id="description" name="description" rows="3" 
                                      placeholder="Enter product description"
                                      oninput="updatePreview('description', this.value)"></textarea>
                            <div class="form-hint">Describe your product in detail</div>
                        </div>
                        
                        <div class="form-row">
                            <div class="form-group">
                                <label for="price">
                                    <i class="fas fa-dollar-sign"></i> Price *
                                </label>
                                <input type="number" id="price" name="price" required 
                                       step="0.01" min="0.01" 
                                       placeholder="0.00"
                                       oninput="calculateRevenue()">
                                <div class="form-hint">Enter price in USD</div>
                            </div>
                            
                            <div class="form-group">
                                <label for="stock_quantity">
                                    <i class="fas fa-boxes"></i> Stock Quantity *
                                </label>
                                <input type="number" id="stock_quantity" name="stock_quantity" 
                                       required min="0" value="10"
                                       oninput="calculateRevenue()">
                                <div class="form-hint">Available units</div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="form-section">
                        <h3><i class="fas fa-cogs"></i> Additional Details</h3>
                        
                        <div class="form-group">
                            <label for="category">
                                <i class="fas fa-tags"></i> Category *
                            </label>
                            <select id="category" name="category" required>
                                <option value="">Select a category</option>
                                <option value="Electronics">Electronics</option>
                                <option value="Clothing">Clothing</option>
                                <option value="Books">Books</option>
                                <option value="Home & Kitchen">Home & Kitchen</option>
                                <option value="Sports">Sports</option>
                                <option value="Beauty">Beauty</option>
                                <option value="Toys">Toys</option>
                                <option value="Other">Other</option>
                            </select>
                        </div>
                        
                        <div class="form-group">
                            <label for="vendor">
                                <i class="fas fa-store"></i> Vendor / Seller
                            </label>
                            <input type="text" id="vendor" name="vendor" 
                                   placeholder="Enter vendor name">
                            <div class="form-hint">Leave blank for user submissions</div>
                        </div>
                        
                        <div class="form-group">
                            <label for="rating">
                                <i class="fas fa-star"></i> Rating
                            </label>
                            <input type="number" id="rating" name="rating" 
                                   min="0" max="5" step="0.1" value="4.0"
                                   placeholder="4.0">
                            <div class="form-hint">0.0 to 5.0 scale</div>
                        </div>
                        
                        <div class="form-group">
                            <label for="tags">
                                <i class="fas fa-hashtag"></i> Tags
                            </label>
                            <input type="text" id="tags" name="tags" 
                                   placeholder="tag1, tag2, tag3">
                            <div class="form-hint">Comma-separated keywords</div>
                        </div>
                    </div>
                    
                    <div class="form-section">
                        <h3><i class="fas fa-chart-line"></i> Analytics Preview</h3>
                        
                        <div class="analytics-preview">
                            <div class="preview-card">
                                <h4>Product Preview</h4>
                                <div id="productPreview" class="product-preview">
                                    <div class="preview-image">
                                        <i class="fas fa-box fa-3x"></i>
                                    </div>
                                    <div class="preview-content">
                                        <h5 id="previewName">Product Name</h5>
                                        <p id="previewDescription">Product description will appear here...</p>
                                        <div class="preview-price">
                                            <span id="previewPrice">$0.00</span>
                                            <span class="preview-stock" id="previewStock">Stock: 0</span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="analytics-cards">
                                <div class="analytics-card">
                                    <div class="analytics-icon">
                                        <i class="fas fa-calculator"></i>
                                    </div>
                                    <div class="analytics-content">
                                        <div class="analytics-label">Inventory Value</div>
                                        <div class="analytics-value" id="inventoryValue">$0.00</div>
                                    </div>
                                </div>
                                
                                <div class="analytics-card">
                                    <div class="analytics-icon">
                                        <i class="fas fa-chart-bar"></i>
                                    </div>
                                    <div class="analytics-content">
                                        <div class="analytics-label">Potential Revenue</div>
                                        <div class="analytics-value" id="potentialRevenue">$0.00</div>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="database-info">
                                <h4><i class="fas fa-database"></i> Storage Information</h4>
                                <div class="db-selector">
                                    <div class="db-option" id="mongoOption" onclick="selectDatabase('mongodb')">
                                        <i class="fas fa-leaf"></i>
                                        <h5>MongoDB</h5>
                                        <p>User submissions, reviews, flexible data</p>
                                        <div class="db-indicator" id="mongoIndicator"></div>
                                    </div>
                                    
                                    <div class="db-option" id="sqlOption" onclick="selectDatabase('sqlserver')">
                                        <i class="fas fa-server"></i>
                                        <h5>SQL Server</h5>
                                        <p>Vendor products, inventory management</p>
                                        <div class="db-indicator" id="sqlIndicator"></div>
                                    </div>
                                </div>
                                <input type="hidden" id="database" name="database" value="mongodb">
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="form-actions">
                    <button type="button" class="btn btn-secondary" onclick="clearForm()">
                        <i class="fas fa-redo"></i> Clear Form
                    </button>
                    <button type="submit" class="btn btn-primary">
                        <i class="fas fa-save"></i> Add Product
                    </button>
                </div>
            </form>
        </div>

        <div class="form-info">
            <div class="info-card">
                <h3><i class="fas fa-info-circle"></i> How it Works</h3>
                <p>When you submit a product:</p>
                <ul>
                    <li><strong>MongoDB:</strong> User-submitted products, reviews, and flexible data structures</li>
                    <li><strong>SQL Server:</strong> Vendor products, inventory management, and transactional data</li>
                    <li><strong>Airflow ETL:</strong> Automatically syncs data between databases daily</li>
                    <li><strong>Analytics:</strong> Real-time processing with Pandas and NumPy</li>
                </ul>
            </div>
            
            <div class="info-card">
                <h3><i class="fas fa-chart-line"></i> Data Flow</h3>
                <div class="flow-diagram">
                    <div class="flow-step">
                        <div class="step-number">1</div>
                        <div class="step-content">
                            <strong>Product Submission</strong>
                            <p>Form data validated and processed</p>
                        </div>
                    </div>
                    <div class="flow-step">
                        <div class="step-number">2</div>
                        <div class="step-content">
                            <strong>Database Storage</strong>
                            <p>Stored in appropriate database based on type</p>
                        </div>
                    </div>
                    <div class="flow-step">
                        <div class="step-number">3</div>
                        <div class="step-content">
                            <strong>ETL Processing</strong>
                            <p>Airflow DAG syncs and transforms data</p>
                        </div>
                    </div>
                    <div class="flow-step">
                        <div class="step-number">4</div>
                        <div class="step-content">
                            <strong>Analytics</strong>
                            <p>Pandas/NumPy generate insights</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <footer class="footer">
        <div class="footer-content">
            <p>&copy; 2024 Mini E-Commerce System. Add products to MongoDB or SQL Server based on type.</p>
        </div>
    </footer>

    <script>
        let selectedDatabase = 'mongodb';
        
        function updatePreview(field, value) {
            switch(field) {
                case 'name':
                    document.getElementById('previewName').textContent = value || 'Product Name';
                    break;
                case 'description':
                    document.getElementById('previewDescription').textContent = 
                        value || 'Product description will appear here...';
                    break;
            }
        }
        
        function calculateRevenue() {
            const price = parseFloat(document.getElementById('price').value) || 0;
            const quantity = parseInt(document.getElementById('stock_quantity').value) || 0;
            
            // Update preview
            document.getElementById('previewPrice').textContent = '$' + price.toFixed(2);
            document.getElementById('previewStock').textContent = 'Stock: ' + quantity;
            
            // Calculate analytics
            const inventoryValue = price * quantity;
            const potentialRevenue = inventoryValue * 0.8; // Assuming 80% sell-through
            
            document.getElementById('inventoryValue').textContent = '$' + inventoryValue.toFixed(2);
            document.getElementById('potentialRevenue').textContent = '$' + potentialRevenue.toFixed(2);
        }
        
        function selectDatabase(db) {
            selectedDatabase = db;
            
            // Update UI
            document.getElementById('mongoIndicator').style.backgroundColor = 
                db === 'mongodb' ? '#4CAF50' : '#ccc';
            document.getElementById('sqlIndicator').style.backgroundColor = 
                db === 'sqlserver' ? '#2196F3' : '#ccc';
            
            // Update hidden field
            document.getElementById('database').value = db;
            
            // Update vendor field hint
            const vendorField = document.getElementById('vendor');
            if (db === 'sqlserver') {
                vendorField.placeholder = 'Required for vendor products';
                vendorField.required = true;
            } else {
                vendorField.placeholder = 'Enter vendor name (optional)';
                vendorField.required = false;
            }
        }
        
        function clearForm() {
            if (confirm('Are you sure you want to clear the form?')) {
                document.getElementById('productForm').reset();
                updatePreview('name', '');
                updatePreview('description', '');
                calculateRevenue();
                selectDatabase('mongodb');
            }
        }
        
        // Initialize
        document.addEventListener('DOMContentLoaded', function() {
            // Set default values for preview
            updatePreview('name', '');
            updatePreview('description', '');
            calculateRevenue();
            selectDatabase('mongodb');
            
            // Real-time validation
            const priceInput = document.getElementById('price');
            priceInput.addEventListener('change', function() {
                if (this.value < 0.01) {
                    this.value = 0.01;
                }
            });
            
            const ratingInput = document.getElementById('rating');
            ratingInput.addEventListener('change', function() {
                if (this.value < 0) this.value = 0;
                if (this.value > 5) this.value = 5;
            });
            
            // Auto-select database based on vendor
            const vendorInput = document.getElementById('vendor');
            vendorInput.addEventListener('input', function() {
                if (this.value.trim() !== '') {
                    selectDatabase('sqlserver');
                } else {
                    selectDatabase('mongodb');
                }
            });
        });
        
        // Form submission validation
        document.getElementById('productForm').addEventListener('submit', function(event) {
            const price = parseFloat(document.getElementById('price').value);
            const quantity = parseInt(document.getElementById('stock_quantity').value);
            
            if (isNaN(price) || price <= 0) {
                alert('Please enter a valid price greater than 0');
                event.preventDefault();
                return;
            }
            
            if (isNaN(quantity) || quantity < 0) {
                alert('Please enter a valid stock quantity');
                event.preventDefault();
                return;
            }
            
            if (selectedDatabase === 'sqlserver' && !document.getElementById('vendor').value.trim()) {
                alert('Vendor name is required for SQL Server storage');
                event.preventDefault();
                return;
            }
            
            // Show loading
            const submitBtn = this.querySelector('button[type="submit"]');
            submitBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Adding Product...';
            submitBtn.disabled = true;
        });
    </script>
</body>
</html>